{% extends 'layout/layout.html.twig' %}
{% block title %} <title>Chart | SpO2 </title>{% endblock %}

{% block main_body %}
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>

<script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

<!-- Include Date Range Picker -->
<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />

<div class="page-wrapper">

    <div class="container-fluid">

        <!-- Page Heading -->
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">
                    SpO2 Chart 
                </h1>
                <ol class="breadcrumb">
                    <li class="active">
                        <i class="fa fa-dashboard">SpO2 Chart</i> 
                    </li>
                </ol>
            </div>
        </div>
        <!-- /.row -->
				<h2>Sensor Infomation</h2>
				{{sensor.name}}<br /><br /> 
<table>
<tr>
<td>	
			Enter seuil in the box: <BR>
													 	<FORM NAME="myform" ACTION="" METHOD="GET">
																<INPUT TYPE="text" NAME="inputbox" VALUE=""><P>
																<INPUT TYPE="button" NAME="button" Value="Submit" onClick="genSeuilManual(this.form)">
														</FORM>
</td>

<td>
		<input type="text" name="daterange" value="01/01/2015 1:30 PM - 01/01/2015 2:00 PM" />
		 
		<script type="text/javascript">
		$(function() {
				$('input[name="daterange"]').daterangepicker({
				    timePicker: true,
				    timePickerIncrement: 3.0,
						timePicker24Hour :true,
						timePickerSeconds :true,
				    locale: {
				        format: 'MM/DD/YYYY h:mm:ss'
				    }
				},
		function(start, end, label) {
   			 alert("A new date range was chosen: " + start.format('MM/DD/YYYY h:mm:ss') + ' to ' + end.format('MM/DD/YYYY h:mm:ss'));
});
		});
</script>
</td>
</tr>
</table>
 	  		<div id="container" style="width: 650px; height: 500px; margin: 0 auto">

				</div>
	  </div>

</div>

<script type="text/javascript">

var tstart = [];
var spo2 = [];

function toJSDate (dateTime) {
	var dateTime = dateTime.split(" ");//dateTime[0] = date, dateTime[1] = time
	var date = dateTime[0].split("-");
	var time = dateTime[1].split(":");
	//var ms = time[2].split(".");
	//(year, month, day, hours, minutes, seconds, milliseconds)
	return Date.UTC(date[0], date[1], date[2], time[0], time[1], time[2]);
}

function seperateData(){
	
	{% for spo2Param in spo2s %}
			var str="{{spo2Param.datetime}}";
			starttime = toJSDate(str);
			tstart.push(starttime);
			spo2.push([starttime,{{spo2Param.saturation}}]);
	{% endfor %}
}

$(function () {
		seperateData();
    $('#container').highcharts({
        chart: {
            type: 'areaspline',
						zoomType: 'x'
        },
        title: {
            text: 'SpO2 Rate'
        },
        legend: {
            layout: 'vertical',
            align: 'left',
            verticalAlign: 'top',
            x: 150,
            y: 20,
            floating: true,
            borderWidth: 1,
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
        },
        xAxis: {
					type: 'datetime',

					dateTimeLabelFormats:{
						//millisecond: '%H:%M:%S.%L',
						second: '%H:%M:%S',
						minute: '%H:%M',
						hour: '%H:%M',
						day: '%e. %b',
						week: '%e. %b',
						month: '%b \'%y',
						year: '%Y'
					},
						
					title: {
            	text: 't/h'
        	},

            /*categories: [
                'Monday',
                'Tuesday',
                'Wednesday',
                'Thursday',
                'Friday',
                'Saturday',
                'Sunday'
            ],

            plotBands: [{ // visualize the weekend
                from: 4.5,
                to: 6.5,
                color: 'rgba(68, 170, 213, .2)'
            }]*/

        },
        yAxis: {
            title: {
                text: 'SpO2 %'
            }
        },
        tooltip: {
            shared: true,
            valueSuffix: ' units'
        },
        credits: {
            enabled: false
        },
        plotOptions: {
            areaspline: {
                fillOpacity: 0.5
            }
        },
        series: [{
            name: 'SpO2',
            data: spo2
        },{
            name: 'seuil',
						type: 'spline',
            data: [],
						color : "#FF0000"
        }]

    });
});
		
/*
function genNumber(){
	list=[];
  n = 0;
	while ( n <= 10){
		list.push(Math.floor((Math.random() * 10) + 89.9)); 
		n++;		
	}
	return list;
}*/

//generate serie of seuil manual
function genSeuilManual(form) {
    var TestVar = form.inputbox.value;
 		var s= Number(TestVar);
		list=[];
		n = 0;
		while ( n <= spo2.length){
			list.push([tstart[n],s]); 
			n++;		
		}

		var chart = $('#container').highcharts();
        chart.series[1].setData(list);
}
/*
function getSeuilManual(){

	var s = prompt("Entree chiffre de seuil :")
  var seuil = Number(s);
	return seuil;
}

function genSeuil(s){
	list=[];
  n = 0;
	while ( n <= 10){
		list.push(s); 
		n++;		
	}
	return list;
}*/

</script>
{% endblock %}


